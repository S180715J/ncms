<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>编辑学生信息</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" href="../css/x-admin.css" media="all">
<link rel="stylesheet" href="../lib/layui/css/layui.css">
</head>

<body>
	<div class="x-body">
		<form class="layui-form">
			<div class="layui-form-item">
				<label for="username" class="layui-form-label"> <span
					class="x-red">*</span>学生&nbsp;&nbsp;&nbsp;ID
				</label>
				<div class="layui-input-inline">
					<input type="text" id="stuid" name="stuid" required=""
						lay-verify="required" autocomplete="off" class="layui-input">
				</div>

			</div>


			<div class="layui-form-item">
				<label for="username" class="layui-form-label"> <span
					class="x-red">*</span>学&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;号
				</label>
				<div class="layui-input-inline">
					<input type="text" id="stucode" name="stucode" required=""
						lay-verify="required" autocomplete="off" class="layui-input">
				</div>
				<div class="layui-form-mid layui-word-aux">
					<span class="x-red">*</span>请输入唯一的学号
				</div>
			</div>


			<div class="layui-form-item">
				<label for="username" class="layui-form-label"> <span
					class="x-red">*</span>学生姓名
				</label>
				<div class="layui-input-inline">
					<input type="text" id="name" name="name" required=""
						lay-verify="required" autocomplete="off" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label for="username" class="layui-form-label">拼&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;音
				</label>
				<div class="layui-input-inline">
					<input type="text" id="pinying" name="pinying" required=""
						autocomplete="off" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item" pane="">
				<label class="layui-form-label">性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别</label>
				<div class="layui-input-block">
					<input type="radio" name="sex" id="sex" value="1" title="男"
						checked=""> <input type="radio" name="sex" id="sex"
						value="2" title="女">
				</div>
			</div>



			<div class="layui-form-item">
				<label for="role" class="layui-form-label"> <span
					class="x-red">*</span>班&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;级
				</label>
				<div class="layui-input-inline">
					<select name="clazz" class="layui-form" lay-filter="xx" id="clazz"
						lay-verify="required">
						<option value="">请选择班级</option>
					</select>
				</div>
			</div>


			<div class="layui-form-item">
				<label for="role" class="layui-form-label"> <span
					class="x-red">*</span>专业方向
				</label>
				<div class="layui-input-inline">
					<select id="specialty" lay-verify="required">
						<option value="">请选择专业方向</option>
					</select>
				</div>
			</div>

			<div class="layui-form-item">
				<label for="role" class="layui-form-label"> <span
					class="x-red">*</span>所在校区
				</label>
				<div class="layui-input-inline">
					<select id="schoolarea" lay-verify="required">
						<option value="">请选择校区</option>
					</select>
				</div>
			</div>

			<div class="layui-form-item">
				<label for="username" class="layui-form-label"></span>民&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;族
				</label>
				<div class="layui-input-inline">
					<input type="text" id="nation" name="nation" required=""
						autocomplete="off" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label for="role" class="layui-form-label"> <span
					class="x-red">*</span>文化程度
				</label>
				<div class="layui-input-inline">
					<select id="edu" lay-verify="required">
						<option value="">请选择文化程度</option>
					</select>
				</div>
			</div>

			<div class="layui-form-item">
				<label for="username" class="layui-form-label"> <span
					class="x-red">*</span>身份证号
				</label>
				<div class="layui-input-inline">
					<input type="text" name="idcard" id="idcard" lay-verify="identity"
						placeholder="" autocomplete="off" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<label for="username" class="layui-form-label"> <span
					class="x-red">*</span>毕业院校
				</label>
				<div class="layui-input-inline">
					<input type="text" id="endschool" name="endschool" required=""
						lay-verify="required" autocomplete="off" class="layui-input">
				</div>
			</div>

			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label"><span class="x-red">*</span>本人手机</label>
					<div class="layui-input-inline">
						<input type="tel" name="phone" id="contact"
							lay-verify="required|phone" autocomplete="off"
							class="layui-input">
					</div>
				</div>


				<div class="layui-form-item">
					<div class="layui-inline">
						<label class="layui-form-label">家人电话</label>
						<div class="layui-input-inline">
							<input type="tel" id="homecontact" name="tel"
								lay-verify="required|phone" autocomplete="off"
								class="layui-input">
						</div>
					</div>


					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> <span
							class="x-red">*</span>家庭住址
						</label>
						<div class="layui-input-inline">
							<input type="text" id="homeaddress" name="homeaddress"
								required="" lay-verify="required" autocomplete="off"
								class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> <span
							class="x-red">*</span>邮&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编
						</label>
						<div class="layui-input-inline">
							<input type="text" id="postcode" name="postcode" required=""
								lay-verify="required" autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> <span
							class="x-red">*</span>QQ号码
						</label>
						<div class="layui-input-inline">
							<input type="text" id="qq" name="homecontact" required=""
								lay-verify="required" autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item" pane="">
						<label class="layui-form-label">是否欠费</label>
						<div class="layui-input-block">
							<input type="radio" name="isdebt" id="isdebt" value="1" title="是"
								checked=""> <input type="radio" name="isdebt"
								id="isdebt" value="0" title="否">
						</div>
					</div>

					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> <span
							class="x-red">*</span>就业城市
						</label>
						<div class="layui-input-inline">
							<input type="text" id="jobcity" name="jobcity" required=""
								lay-verify="required" autocomplete="off" class="layui-input">
						</div>
					</div>


					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> <span
							class="x-red">*</span>就业企业
						</label>
						<div class="layui-input-inline">
							<input type="text" id="jobcompany" name="jobcompany" required=""
								lay-verify="required" autocomplete="off" class="layui-input">
						</div>
					</div>


					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> <span
							class="x-red">*</span>就业薪资
						</label>
						<div class="layui-input-inline">
							<input type="text" id="jobsal" name="jobsal" required=""
								lay-verify="required" autocomplete="off" class="layui-input">
						</div>
					</div>


					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> <span
							class="x-red">*</span>就业岗位
						</label>
						<div class="layui-input-inline">
							<input type="text" id="job" name="job" required=""
								lay-verify="required" autocomplete="off" class="layui-input">
						</div>
					</div>


					<div class="layui-form-item">
						<label for="username" class="layui-form-label"> </span>备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注
						</label>
						<div class="layui-input-inline">
							<input type="text" id="remark" name="remark" required=""
								autocomplete="off" class="layui-input">
						</div>
					</div>



					<div class="layui-form-item" pane="">
						<label class="layui-form-label">是否删除</label>
						<div class="layui-input-block">
							<input type="radio" name="isdelete" id="isdelete" value="1"
								title="是" checked=""> <input type="radio"
								name="isdelete" id="isdelete" value="0" title="否">

						</div>



						<div class="layui-form-item">
							<label for="L_repass" class="layui-form-label"> </label>
							<button class="layui-btn" type="button" id="edit">修改</button>
						</div>
		</form>
	</div>
	<script src="../lib/layui/layui.js" charset="utf-8"></script>
	<script src="../js/x-layui.js" charset="utf-8"></script>
	<script type="text/javascript" src="../js/jquery.min.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
	<script type="text/javascript">
	//显示所属专业、所属院校、文化水平下拉框
	$.ajax({
		type : 'get',
		url : HOST_URL + 'list',
		dataType : 'json',
		success : function(data) {
			var specialtys = '';//所属专业下拉框
			var schoolarea = '';//所属院校下拉框
			var edu = '';//文化水平下拉框
			$.each(data, function(i, obj) {
				$.each(obj, function(i, d) {
					if (d.dicttype == 'specialty') {
						specialtys += '<option value="'+d.dictid+'">'
								+ d.dicname + '</option>'
						$('#specialty').html(specialtys);
					} else if (d.dicttype == 'school_area') {
						schoolarea += '<option value="'+d.dictid+'">'
								+ d.dicname + '</option>'
						$('#schoolarea').html(schoolarea);
					} else if (d.dicttype == 'education') {
						edu += '<option value="'+d.dictid+'">'
								+ d.dicname + '</option>'
						$('#edu').html(edu);
					}
				})
			})
		}
	});
	//显示班级下拉框
	$.ajax({
		type : 'get',
		url : HOST_URL + 'clazzs',
		dataType : 'json',
		success : function(data) {
			var clazz = '';//所属专业下拉框

			$.each(data, function(i, a) {
				clazz += '<option value="'+a.classid+'">' + a.code
						+ '</option>'
				$('#clazz').html(clazz);

			});
		}
	});


		//用于获取页面加载所需要的数据
		function loadStuById() {
			var url = location.search; //h获取url中“？”后面的字符串
			var stuid = -1;
			if (url.indexOf("?") != -1) {
				var str = url.substr(1); //stuid==
				var strs = str.split("=");
				stuid = strs[1];
			}

			if (stuid != -1) {
				$.ajax({
					type : "get",
					url : HOST_URL + 'showStudent/' + stuid,
					dataType : 'json',
					success : function(data) {
					stucode = $("#stuid").attr('value', data.stuid);
					stucode = $("#stucode").attr('value', data.stucode);
					name = $("#name").attr('value', data.name);
					pinying = $("#pinying").attr('value', data.pinying);
					sex = $("input[type=radio][name='sex'][value='"+ data.sex.dictid + "']").attr("checked", 'checked');
					clazz=$("#clazz").find("option[value='"+data.clazz.classid+"']").attr("selected",true);
					$('#specialty>option').each(function(i) {
						var v = $(this).val();
						if (v == data.specialty.dictid) {
							$(this).attr('selected', 'selected');
						}
					});
					schoolarea=$("#schoolarea").find("option[value='"+data.schoolarea.dictid+"']").attr("selected",true);
					nation = $("#nation").attr('value', data.nation);
					edu=$("#edu").find("option[value='"+data.edu.dictid+"']").attr("selected",true);
					idcard = $("#idcard").attr('value', data.idcard);
					contact = $("#contact").attr('value', data.contact);
					homecontact = $("#homecontact").attr('value',data.homecontact);
					homeaddress = $("#homeaddress").attr('value',data.homeaddress);
					qq = $("#qq").attr('value', data.qq);
					isdebt = $("input[type=radio][name='isdebt'][value='"+ data.isdebt + "']").attr("checked",'checked')
					jobcity = $("#jobcity").attr('value', data.jobcity);
					jobcompany = $("#jobcompany").attr('value',data.jobcompany);
					jobsal = $("#jobsal").attr('value', data.jobsal);
					job = $("#job").attr('value', data.job);
					remark = $("#remark").attr('value', data.remark);
					isdelete = $("input[type=radio][name='isdelete'][value='"+ data.isdelete.dictid + "']").attr("checked", 'checked')
					endschool = $("#endschool").attr('value',data.endschool);
					postcode = $("#postcode").attr('value', data.postcode);
				}
				});
			}
		};

		loadStuById();
		//修改事件
		$("#edit").click(function() {
			var stuid = $("#stuid").val();
			var stucode = $("#stucode").val();
			var name = $("#name").val();
			var pinying = $("#pinying").val();
			var sex = $("input[name='sex']:checked").val();
			var clazz = $("#clazz option:selected").val();
			var specialty = $("#specialty option:selected").val();
			var schoolarea = $("#schoolarea option:selected").val();
			var nation = $("#nation").val();
			var edu = $("#edu option:selected").val();
			var idcard = $("#idcard").val();
			var contact = $("#contact").val();
			var homecontact = $("#homecontact").val();
			var homeaddress = $("#homeaddress").val();
			var qq = $("#qq").val();
			var isdebt = $("input[name='isdebt']:checked").val();
			var jobcity = $("#jobcity").val();
			var jobcompany = $("#jobcompany").val();
			var jobsal = $("#jobsal").val();
			var job = $("#job").val();
			var remark = $("#remark").val();
			var isdelete = $("input[name='isdelete']:checked").val();
			var endschool = $("#endschool").val();
			var postcode = $("#postcode").val();
			$.ajax({
				type : 'put',
				url : HOST_URL + 'updStudent',
				//contentType:'application/json;charset=utf-8',
				data : {
					"stuid" : stuid,
					"stucode" : stucode,
					"name" : name,
					"pinying" : pinying,
					"sex.dictid" : sex,
					"clazz.classid" : clazz,
					"specialty.dictid" : specialty,
					"schoolarea.dictid" : schoolarea,
					"nation" : nation,
					"edu.dictid" : edu,
					"idcard" : idcard,
					"homecontact" : homecontact,
					"homeaddress" : homeaddress,
					"qq" : qq,
					"isdebt.dictid" : isdebt,
					"jobcity" : jobcity,
					"jobcompany" : jobcompany,
					"jobsal" : jobsal,
					"job" : job,
					"remark" : remark,
					"isdelete.dictid" : isdelete,
					"endschool" : endschool,
					"postcode" : postcode,
					"contact" : contact,
				},
				dataType : 'text',
				success : function(data) {
					if (data == "ok") {
						layer.msg('修改成功！', {
							time : 2000,
							icon : 1
						});
						parent.location.reload();
					}
				}
			});

		});
	</script>
	<script>
		layui.use([ 'form', 'layer' ], function() {
			$ = layui.jquery;
			var form = layui.form(), layer = layui.layer;

			//自定义验证规则
			form.verify({
				nikename : function(value) {
					if (value.length < 5) {
						return '昵称至少得5个字符啊';
					}
				},
				pass : [ /(.+){6,12}$/, '密码必须6到12位' ],
				repass : function(value) {
					if ($('#L_pass').val() != $('#L_repass').val()) {
						return '两次密码不一致';
					}
				}
			});

			/* //监听提交
			form.on('submit(add)', function(data) {
				var form=layui.form;
					var jsonStr=JSON.stringify(data.field);
					alert("shuju=="+jsonStr);
					 $.ajax({
						type:'post',
						url:'http://localhost:8080/ncms/addStudent',
						contentType:'application/json;charset=utf-8',
						data:jsonStr,
						dataType:'text',
						success:function(data){
							if(data=='ok'){
								layer.msg('添加成功！',{time:1000,icon: 1});
								parent.location.reload();
							}
						}
						
					}); 
				return false;
			}); */

		});
	</script>

</body>

</html>